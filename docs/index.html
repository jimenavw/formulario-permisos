<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario Condicional de Permisos</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { color: #333; }
  .hidden { display: none; }
  .section { margin: 15px 0; padding: 10px; border: 1px solid #ccc; border-radius: 6px; background: #f9f9f9; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input, textarea, select { width: 100%; padding: 6px; margin-top: 4px; }
  button { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  .result { margin-top: 20px; padding: 15px; border: 2px solid #0073e6; background: #eef7ff; white-space: pre-wrap; }
  .description { font-size: 14px; color: #555; margin-bottom: 8px; }
</style>
</head>
<body>

<h2>Formulario Condicional de Permisos</h2>

<!-- Selección principal -->
<div class="section">
  <label for="permiso">Selecciona el tipo de permiso:</label>
  <select id="permiso" onchange="mostrarFormulario()">
    <option value="">-- Selecciona --</option>
    <option value="regular">Permiso Regular / Permiso de Desviación</option>
    <option value="eilt">Permiso Eilt Sehr</option>
    <option value="notfall">Notfall</option>
  </select>

  <div id="descripcion" class="description hidden"></div>
</div>

<!-- Formulario Condicional -->
<div id="formulario" class="hidden">

  <!-- PROBLEMA -->
  <div class="section">
    <h3>PROBLEMA</h3>
    <label>Necesidades:</label>
    <input type="text" id="necesidades">

    <label>Proyecto:</label>
    <input type="text" id="proyecto">

    <label>NP Afectado:</label>
    <input type="text" id="np">

    <label>¿Cuándo debe entrar la desviación?</label>
    <input type="text" id="fecha">

    <label>¿Qué está pasando? (Especificar claramente):</label>
    <textarea id="quePasa"></textarea>
  </div>

  <!-- CAUSA -->
  <div class="section">
    <h3>CAUSA</h3>
    <label>¿Qué provocó el problema? (Explicar claramente):</label>
    <textarea id="causa"></textarea>
  </div>

  <!-- MEDIDA -->
  <div class="section">
    <h3>MEDIDA</h3>
    <label>Solución propuesta:</label>
    <textarea id="solucion"></textarea>

    <label>¿Qué propones para no parar la línea?</label>
    <textarea id="propuesta"></textarea>

    <label>¿Qué pasaría si no se implementa esta desviación?</label>
    <textarea id="consecuencia"></textarea>

    <label>¿Quién realiza dicha medida?</label>
    <input type="text" id="responsable">

    <!-- Extra preguntas para Notfall -->
    <div id="notfallExtras" class="hidden">
      <h4>Preguntas adicionales para Notfall</h4>
      <label>¿Ya se implementó la instalación alternativa?</label>
      <input type="text" id="instalacionAlt">

      <label>¿Existe una fecha claramente definida para la construcción alternativa?</label>
      <input type="text" id="fechaAlt">

      <label>¿Puede implementarse el apuntalamiento alternativo lo antes posible después de la aprobación?</label>
      <input type="text" id="apuntalamiento">
    </div>
  </div>

  <!-- BOTÓN RESULTADO -->
  <button onclick="generarResumen()">Generar y Copiar Prompt</button>
</div>

<!-- RESULTADO -->
<div id="resultado" class="result hidden"></div>

<script>
const descripciones = {
  regular: `• No hay riesgo de que el permiso PC8 se expida rápidamente.
• Necesidad previsible de una desviación.
• Acontecimiento planificable.
• Impacto >6 semanas.`,
  eilt: `• Puede que no sea posible expedir rápidamente el permiso PC8 (<6 semanas).
• Necesidad ya producida, suceso imprevisible.
• Requiere acción rápida.`,
  notfall: `• Proceso PC8 paralizado completamente.
• Necesidad inmediata de aprobación AE.
• Peligro inminente.`
};

const promptBase = `Todos los permisos deben cumplir con los siguientes requisitos clave:
1. Problema (Problem):
• Debe quedar claro si se trata de un cambio técnico en el vehículo.
• La descripción del problema debe ser clara, completa y comprensible, incluso para personas ajenas al tema.
• Evitar abreviaturas o escribirlas completas la primera vez.
• Incluir particularidades como restricciones a ciertos vehículos o razones específicas para la adición.
• Indicar el desencadenante del problema: dónde/cuándo se detectó (p. ej. análisis DMU, prueba de construcción, etc.).
• Para sociedades chinas externas (JV), revisar el campo correspondiente.
2. Causa (Cause):
• Explicar quién o qué causó el problema, y dónde ocurrió.
• La causa debe estar descrita de forma clara, completa y comprensible.
• Para sociedades chinas externas (JV) chinas, revisar el nombre del campo externo.
3. Medida (Measure):
• Las acciones para resolver el problema deben estar descritas claramente y con todos los detalles necesarios.
• Debe indicarse quién realizará la medida (proveedor o producción) y en qué parte del vehículo.
• La medida debe ser un cambio técnico obligatorio.
• En permisos con motivo "Falta la autorización K", se deben documentar:
  o Conformidad legal, seguridad y adecuación al mercado del componente.
• Para aprobaciones en obra 11/12:
  o Describir inicio de validez concreto.
  o Cumplir con OA 700-3.
  o En casos de lectura de errores, detallar impactos al cliente.

A continuación, recibirás un texto. Tu tarea será identificar qué elementos obligatorios faltan, en función del tipo de permiso. No completes ni inventes datos. Solo identifica las ausencias.
Tu salida deberá presentarse en formato de tabla, con los siguientes idiomas:
• Español
• Inglés
• Alemán

Texto finalizado:\n`;

function mostrarFormulario() {
  const tipo = document.getElementById('permiso').value;
  const desc = document.getElementById('descripcion');
  const form = document.getElementById('formulario');
  const extras = document.getElementById('notfallExtras');

  if (tipo) {
    desc.textContent = descripciones[tipo];
    desc.classList.remove('hidden');
    form.classList.remove('hidden');
    extras.classList.toggle('hidden', tipo !== 'notfall');
  } else {
    desc.classList.add('hidden');
    form.classList.add('hidden');
  }
}

function generarResumen() {
  const tipo = document.getElementById('permiso').value;
  const necesidades = document.getElementById('necesidades').value;
  const proyecto = document.getElementById('proyecto').value;
  const np = document.getElementById('np').value;
  const fecha = document.getElementById('fecha').value;
  const quePasa = document.getElementById('quePasa').value;
  const causa = document.getElementById('causa').value;
  const solucion = document.getElementById('solucion').value;
  const propuesta = document.getElementById('propuesta').value;
  const consecuencia = document.getElementById('consecuencia').value;
  const responsable = document.getElementById('responsable').value;

  let resumen = `TIPO DE PERMISO: ${tipo.toUpperCase()}\n\n`;

  resumen += `PROBLEMA:\n- Necesidades: ${necesidades}\n- Proyecto: ${proyecto}\n- NP Afectado: ${np}\n- Fecha: ${fecha}\n- Qué está pasando: ${quePasa}\n\n`;
  resumen += `CAUSA:\n${causa}\n\n`;
  resumen += `MEDIDA:\n- Solución: ${solucion}\n- Propuesta: ${propuesta}\n- Consecuencia: ${consecuencia}\n- Responsable: ${responsable}\n`;

  if (tipo === 'notfall') {
    const instalacionAlt = document.getElementById('instalacionAlt').value;
    const fechaAlt = document.getElementById('fechaAlt').value;
    const apuntalamiento = document.getElementById('apuntalamiento').value;

    resumen += `\nPREGUNTAS ADICIONALES:\n- Instalación alternativa: ${instalacionAlt}\n- Fecha definida: ${fechaAlt}\n- Apuntalamiento alternativo posible: ${apuntalamiento}\n`;
  }

  const fullText = promptBase + resumen;

  // Mostrar en pantalla
  const resultBox = document.getElementById('resultado');
  resultBox.textContent = fullText;
  resultBox.classList.remove('hidden');

  // Copiar al portapapeles
  navigator.clipboard.writeText(fullText).then(() => {
    alert("✅ Texto copiado al portapapeles.");
  }).catch(err => {
    alert("❌ No se pudo copiar automáticamente. Copia manualmente.");
  });
}
</script>
</body>
</html>
