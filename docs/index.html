<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FORMULARIO CONDICIONAL DE PERMISOS</title>
<style>
  :root {
    --color-fondo: #008C82;
    --color-acento: #ffffff;
    --color-texto-claro: #ffffff;
    --color-gris: #f9f9f9;
    --color-warning-bg: #fff3cd;
    --color-warning-border: #ffeeba;
    --color-info-bg: #eef7ff;
    --color-info-border: #0073e6;
    --color-texto: #008C82;
    --color-button: #66BAB4;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: var(--color-fondo);
    color: var(--color-texto-claro);
  }

  h1 {
    color: var(--color-acento);
    text-align: center;
  }

  h2 {
    color: var(--color-texto);
    text-align: center;
  }

  .hidden {
    display: none;
  }

  .section {
    margin: 15px 0;
    padding: 15px;
    border: 1px solid var(--color-acento);
    border-radius: 6px;
    background-color: var(--color-gris);
    color: #000;
  }

  .warning {
    background-color: var(--color-warning-bg);
    border-color: var(--color-warning-border);
    color: #000;
    font-weight: bold;
  }

  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
    color: inherit;
  }

  input, textarea, select {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: var(--color-button);
    color: var(--color-texto-claro);
    border: none;
    border-radius: 5px;
    transition: background 0.3s ease;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  button:hover {
    background-color: #66BAB4;
  }

  .result {
    margin-top: 20px;
    padding: 15px;
    border: 2px solid var(--color-info-border);
    background: var(--color-info-bg);
    white-space: pre-wrap;
    color: #000;
    border-radius: 6px;
  }

  .description {
    font-size: 14px;
    color: var(--color-fondo);
    margin-top: 10px;
  }

  .copilot-section {
    text-align: center;
    margin-top: 20px;
    padding: 15px;
    background-color: var(--color-gris);
    border-radius: 6px;
    color: #000;
  }
</style>
</head>
<body>

<h1>FORMULARIO CONDICIONAL DE PERMISOS</h1>

<!-- Selecci√≥n principal -->
<div class="section">
  <label for="permiso">Selecciona el tipo de permiso:</label>
  <select id="permiso" onchange="mostrarFormulario()">
    <option value="">-- Selecciona --</option>
    <option value="regular">Permiso Regular / Permiso de Desviaci√≥n</option>
    <option value="eilt">Permiso Eilt Sehr</option>
    <option value="notfall">Notfall</option>
    <option value="doc">Ya tengo el documento</option>
  </select>

  <div id="descripcion" class="description hidden"></div>
</div>

<!-- Formulario Condicional -->
<div id="formulario" class="hidden">

  <!-- Mensaje adicional -->
  <div class="section warning">
    <strong>Coloca 'NA' si es que algo no aplica</strong>
  </div>

  <!-- Mensaje para evitar abreviaturas-->
   <div class="section warning">
    <strong>Evita abreviaturas; si las usas, def√≠nelas la primera vez</strong>
  </div>

  <!-- PROBLEMA -->
  <div class="section">
    <h2>PROBLEMA</h2>

    <label>Necesidades:</label>
    <input type="text" id="necesidades">

    <label>Proyecto:</label>
    <input type="text" id="proyecto">

    <label>NP Afectado y Ubicaci√≥n:</label>
    <input type="text" id="np">

    <label>¬øCu√°ndo debe entrar la desviaci√≥n?</label>
    <input type="text" id="fecha">

    <label>¬øQu√© est√° pasando? Especificar claramente. Por ejemplo: Hay escasez de 'x' material, entonces no se puede construir 'y' ensamble. Haz que sea lo m√°s claro posible)</label>
    <textarea id="quePasa"></textarea>

    <label>¬øEs un problema t√©cnico en el veh√≠culo? Especifica qu√© es</label>
    <input type="text" id="tecnico">

    <label>Particularidades extra (Como restricciones a ciertos veh√≠culos o razones espec√≠ficas para la adici√≥n)</label>
    <input type="text" id="particularidades">

    <label>¬øEn qu√© parte del proceso se detect√≥ el problema? (Por ejemplo: En una auditor√≠a / falla de campo)</label>
    <textarea id="donde"></textarea>

  </div>

  <!-- CAUSA -->
  <div class="section">
    <h2>CAUSA</h2>
    <label>¬øQu√©/qui√©n provoc√≥ el problema?</label>
    <textarea id="causa"></textarea>
  </div>

  <!-- MEDIDA -->
  <div class="section">
    <h2>MEDIDA</h2>

    <label>¬øQu√© propones para no parar la l√≠nea? (Por ejemplo: Utilizar una pieza en lugar de otra)</label>
    <textarea id="propuesta"></textarea>

    <label>¬øQu√© pasar√≠a si no se implementa esta desviaci√≥n? (Por ejemplo: "Para evitar el paro de l√≠nea, se utilizar√≠a 'x' pieza de 'y' proveedor)</label>
    <textarea id="consecuencia"></textarea>

    <label>¬øQui√©n realiza dicha medida? (Por ejemplo: Proveedor, se har√° en casa, etc.)</label>
    <input type="text" id="responsable">

    <label>Si genera costos, ¬øqui√©n los cubrir√°?</label>
    <input type="text" id="cost">

    <label>En permisos con motivo "Falta la liberaci√≥n K & BMG", documenta: Conformidad legal, seguridad y adecuaci√≥n al mercado del componente</label>
    <input type="text" id="legal">

  </div>

  <div class="section">
    <div id="notfallExtras" class="hidden">
    <h2>PREGUNTAS DE CONTROL NOTFALL</h2>

      <label>¬øYa se implement√≥ la instalaci√≥n alternativa?</label>
      <input type="text" id="instalacionAlt">

      <label>¬øExiste una fecha claramente definida para la construcci√≥n alternativa?</label>
      <input type="text" id="fechaAlt">

      <label>¬øPuede implementarse el apuntalamiento alternativo lo antes posible antes de la aprobaci√≥n?</label>
      <input type="text" id="apuntalamiento">
    </div>
    </div>
  

  <!-- BOT√ìN RESULTADO -->
  <button onclick="generarResumen()">Generar y Copiar Prompt</button>

</div>

<!-- Secci√≥n Copilot (ahora m√°s visible) -->
<div id="copilotSection" class="copilot-section hidden">
  <button onclick="enviarACopilot()" id="botonCopilot">üöÄ Ir a Microsoft Copilot</button>
  <p id="mensajeCopilot" class="description">
    ‚úÖ El prompt fue copiado. <strong>Haz clic en el bot√≥n de arriba</strong> o ve a Microsoft Copilot y presiona <strong>Ctrl + V</strong> para pegarlo.
  </p>
</div>

<!-- RESULTADO -->
<div id="resultado" class="result hidden"></div>

<script>
const descripciones = {
  regular: `‚Ä¢ No hay riesgo de que el permiso PC8 se expida r√°pidamente.
‚Ä¢ Necesidad previsible de una desviaci√≥n.
‚Ä¢ Acontecimiento planificable.
‚Ä¢ Impacto >6 semanas.`,
  eilt: `‚Ä¢ Puede que no sea posible expedir r√°pidamente el permiso PC8 (<6 semanas).
‚Ä¢ Necesidad ya producida, suceso imprevisible.
‚Ä¢ Requiere acci√≥n r√°pida.`,
  notfall: `‚Ä¢ Proceso PC8 paralizado completamente.
‚Ä¢ Necesidad inmediata de aprobaci√≥n AE.
‚Ä¢ Peligro inminente.`
};

const promptBase = `Todos los permisos deben cumplir con los siguientes requisitos clave:
1. Problema (Problem):
‚Ä¢ Debe quedar claro si se trata de un cambio t√©cnico en el veh√≠culo.
‚Ä¢ La descripci√≥n del problema debe ser clara, completa y comprensible, incluso para personas ajenas al tema.
‚Ä¢ Evitar abreviaturas o escribirlas completas la primera vez.
‚Ä¢ Incluir particularidades como restricciones a ciertos veh√≠culos o razones espec√≠ficas para la adici√≥n.
‚Ä¢ Indicar el desencadenante del problema: d√≥nde/cu√°ndo se detect√≥ (p. ej. an√°lisis DMU, prueba de construcci√≥n, etc.)
2. Causa (Cause):
‚Ä¢ Explicar qui√©n o qu√© caus√≥ el problema, y d√≥nde ocurri√≥.
‚Ä¢ La causa debe estar descrita de forma clara, completa y comprensible.
3. Medida (Measure):
‚Ä¢ Las acciones para resolver el problema deben estar descritas claramente y con todos los detalles necesarios.
‚Ä¢ Debe indicarse qui√©n realizar√° la medida (proveedor o producci√≥n) y en qu√© parte del veh√≠culo.
  Si genera costos, debe mencionar qui√©n los cubrir√° (qu√© departamento o √°rea)
‚Ä¢ La medida debe ser un cambio t√©cnico obligatorio.
‚Ä¢ En permisos con motivo "Falta la autorizaci√≥n K", se deben documentar:
  o Conformidad legal, seguridad y adecuaci√≥n al mercado del componente.

Si en alg√∫n apartado del texto aparece 'NA', se considerar√° como 'no aplica' y ese criterio ser√° ignorado para la revisi√≥n.

A continuaci√≥n, recibir√°s un texto. Tu tarea ser√° identificar qu√© elementos obligatorios faltan, en funci√≥n del tipo de permiso. No completes ni inventes datos. Solo identifica las ausencias.
Tu salida deber√° presentarse en formato de tabla, con los siguientes idiomas:
‚Ä¢ Espa√±ol
‚Ä¢ Ingl√©s
‚Ä¢ Alem√°n

Texto finalizado:\n`;

function mostrarFormulario() {
  const tipo = document.getElementById('permiso').value;
  const desc = document.getElementById('descripcion');
  const form = document.getElementById('formulario');
  const extras = document.getElementById('notfallExtras');
  const copilotSection = document.getElementById('copilotSection');
  const resultado = document.getElementById('resultado');

  if (tipo === "doc") {
    // Oculta formulario y descripci√≥n
    desc.classList.add('hidden');
    form.classList.add('hidden');

    // Muestra prompt directamente
    const fullText = promptBase + "[Pega aqu√≠ tu texto ya generado...]";
    resultado.textContent = fullText;
    resultado.classList.remove('hidden');

    // Mostrar secci√≥n Copilot
    copilotSection.classList.remove('hidden');

    // Copiar autom√°ticamente
    navigator.clipboard.writeText(fullText).then(() => {
      alert("‚úÖ Prompt copiado autom√°ticamente. Ahora haz clic en el bot√≥n o ve a Copilot y presiona Ctrl + V.");
    }).catch(() => {
      alert("‚ùå No se pudo copiar autom√°ticamente. Copia manualmente.");
    });
  } else if (tipo) {
    desc.textContent = descripciones[tipo] || "";
    desc.classList.remove('hidden');
    form.classList.remove('hidden');
    extras.classList.toggle('hidden', tipo !== 'notfall');

    // Ocultar elementos espec√≠ficos del caso "doc"
    copilotSection.classList.add('hidden');
    resultado.classList.add('hidden');
  } else {
    // Reinicia todo si no se selecciona nada
    desc.classList.add('hidden');
    form.classList.add('hidden');
    extras.classList.add('hidden');
    copilotSection.classList.add('hidden');
    resultado.classList.add('hidden');
  }
}

function generarResumen() {
  const tipo = document.getElementById('permiso').value;
  if (tipo === "doc") return;
  
  // Validar campos obligatorios
  const camposObligatorios = [
    { id: 'necesidades', nombre: 'Necesidades' },
    { id: 'proyecto', nombre: 'Proyecto' },
    { id: 'np', nombre: 'NP Afectado y Ubicaci√≥n' },
    { id: 'fecha', nombre: 'Fecha' },
    { id: 'quePasa', nombre: '¬øQu√© est√° pasando?' },
    { id: 'tecnico', nombre: 'Problema t√©cnico' },
    { id: 'particularidades', nombre: 'Particularidades extra' },
    { id: 'donde', nombre: '¬øD√≥nde se detect√≥ el problema?' },
    { id: 'causa', nombre: '¬øQu√©/qui√©n provoc√≥ el problema?' },
    { id: 'propuesta', nombre: '¬øQu√© propones para no parar la l√≠nea?' },
    { id: 'consecuencia', nombre: '¬øQu√© pasar√≠a si no se implementa esta desviaci√≥n?' },
    { id: 'responsable', nombre: '¬øQui√©n realiza dicha medida?' }
  ];

  if (tipo === 'notfall') {
    camposObligatorios.push(
      { id: 'instalacionAlt', nombre: '¬øYa se implement√≥ la instalaci√≥n alternativa?' },
      { id: 'fechaAlt', nombre: '¬øFecha definida para construcci√≥n alternativa?' },
      { id: 'apuntalamiento', nombre: '¬øPuede implementarse el apuntalamiento alternativo?' }
    );
  }

  const camposFaltantes = camposObligatorios.filter(campo => {
    const valor = document.getElementById(campo.id).value.trim();
    return valor === '';
  });

  if (camposFaltantes.length > 0) {
    const listaCampos = camposFaltantes.map(c => `‚Ä¢ ${c.nombre}`).join('\n');
    alert(`‚ö†Ô∏è Por favor completa los siguientes campos obligatorios antes de generar el prompt:\n\n${listaCampos}`);
    return;
  }

  const necesidades = document.getElementById('necesidades').value;
  const proyecto = document.getElementById('proyecto').value;
  const np = document.getElementById('np').value;
  const fecha = document.getElementById('fecha').value;
  const quePasa = document.getElementById('quePasa').value;
  const particularidades = document.getElementById('particularidades').value;
  const tecnico = document.getElementById('tecnico').value;
  const causa = document.getElementById('causa').value;
  const donde = document.getElementById('donde').value;
  const propuesta = document.getElementById('propuesta').value;
  const consecuencia = document.getElementById('consecuencia').value;
  const responsable = document.getElementById('responsable').value;
  const cost = document.getElementById('cost').value;
  const legal = document.getElementById('legal').value;

  let resumen = `TIPO DE PERMISO: ${tipo.toUpperCase()}\n\n`;

  resumen += `PROBLEMA:\n- Necesidades: ${necesidades}\n- Proyecto: ${proyecto}\n- NP Afectado: ${np}\n- Fecha: ${fecha}\n- Qu√© est√° pasando: ${quePasa}\n- Problema t√©cnico: ${tecnico}\n- Particularidades: ${particularidades}\n-D√≥nde ocurri√≥:${donde}\n\n`;
  resumen += `CAUSA:\n${causa}\n\n`;
  resumen += `MEDIDA:\n- Propuesta: ${propuesta}\n- Consecuencia: ${consecuencia}\n- Responsable: ${responsable}\n- Qui√©n cubre los costos: ${cost}\n- Falta autorizaci√≥n K & BMG: ${legal}\n\n`;

  if (tipo === 'notfall') {
    const instalacionAlt = document.getElementById('instalacionAlt').value;
    const fechaAlt = document.getElementById('fechaAlt').value;
    const apuntalamiento = document.getElementById('apuntalamiento').value;

    resumen += `\nPREGUNTAS ADICIONALES:\n- Instalaci√≥n alternativa: ${instalacionAlt}\n- Fecha definida: ${fechaAlt}\n- Apuntalamiento alternativo posible: ${apuntalamiento}\n`;
  }

  const fullText = promptBase + resumen;

  const resultBox = document.getElementById('resultado');
  resultBox.textContent = fullText;
  resultBox.classList.remove('hidden');

  const copilotSection = document.getElementById('copilotSection');
  copilotSection.classList.remove('hidden');

  navigator.clipboard.writeText(fullText).then(() => {
    alert("‚úÖ Texto copiado al portapapeles.");
  }).catch(err => {
    alert("‚ùå No se pudo copiar autom√°ticamente. Copia manualmente.");
  });
}

function enviarACopilot() {
  window.open("https://copilot.microsoft.com", "_blank");
}

</script>

</body>
</html>
