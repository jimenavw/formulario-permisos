<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FORMULARIO CONDICIONAL DE PERMISOS</title>
<style>
  :root {
    --color-fondo: #008C82;
    --color-acento: #ffffff;
    --color-texto-claro: #ffffff;
    --color-gris: #f9f9f9;
    --color-warning-bg: #fff3cd;
    --color-warning-border: #ffeeba;
    --color-info-bg: #eef7ff;
    --color-info-border: #0073e6;
    --color-texto: #008C82;
    --color-button: #66BAB4;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: var(--color-fondo);
    color: var(--color-texto-claro);
  }

  h1 {
    color: var(--color-acento);
    text-align: center;
  }

  h2 {
    color: var(--color-texto);
    text-align: center;
  }

  .hidden {
    display: none;
  }

  .section {
    margin: 15px 0;
    padding: 15px;
    border: 1px solid var(--color-acento);
    border-radius: 6px;
    background-color: var(--color-gris);
    color: #000;
  }

  .warning {
    background-color: var(--color-warning-bg);
    border-color: var(--color-warning-border);
    color: #000;
    font-weight: bold;
  }

  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
    color: inherit;
  }

  input, textarea, select {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: var(--color-button);
    color: var(--color-texto-claro);
    border: none;
    border-radius: 5px;
    transition: background 0.3s ease;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  button:hover {
    background-color: #66BAB4;
  }

  .result {
    margin-top: 20px;
    padding: 15px;
    border: 2px solid var(--color-info-border);
    background: var(--color-info-bg);
    white-space: pre-wrap;
    color: #000;
    border-radius: 6px;
  }

  .description {
    font-size: 14px;
    color: var(--color-fondo);
    margin-top: 10px;
  }

  .copilot-section {
    text-align: center;
    margin-top: 20px;
    padding: 15px;
    background-color: var(--color-gris);
    border-radius: 6px;
    color: #000;
  }
</style>
</head>
<body>

<h1>PERMITS FORMS</h1>

<!-- Principal selection -->
<div class="section">
  <label for="permiso">Select the permit type:</label>
  <select id="permiso" onchange="mostrarFormulario()">
    <option value="">-- Select --</option>
    <option value="regular">Regular Permit / Deviation Permit</option>
    <option value="eilt">Eilt Sehr Permit</option>
    <option value="notfall">Notfall</option>
    <option value="doc">I already have the document</option>
  </select>

  <div id="descripcion" class="description hidden"></div>
</div>

<!-- Conditional forms -->
<div id="formulario" class="hidden">

  <!-- Additional message -->
  <div class="section warning">
    <strong>Write 'NA' if not applicable</strong>
  </div>

  <!-- Message to avoid abbreviations-->
   <div class="section warning">
    <strong>Do not use abbreviations unless unavoidable, and define them upon first use.</strong>
  </div>

  <!-- PROBLEM -->
  <div class="section">
    <h2>ISSUE</h2>

    <label>Needs:</label>
    <input type="text" id="necesidades">

    <label>Project:</label>
    <input type="text" id="proyecto">

    <label>Impacted Part Number and Location</label>
    <input type="text" id="np">

    <label>When should the deviation be entered?</label>
    <input type="text" id="fecha">

    <label>What is happening? Describe the situation clearly. (For example: Material X is unavailable, so assembly Y cannot be produced.) Be as specific as possible</label>
    <textarea id="quePasa"></textarea>

    <label>Is it a technical issue with the vehicle? If so, specify what is it and provide details.</label>
    <input type="text" id="tecnico">

    <label>Extra particularities (e.g., restrictions on certain vehicles or specific reasons for the addition)</label>
    <input type="text" id="particularidades">

    <label>At what stage of the process was the issue detected? (e.g., during a field audit or a failure)</label>
    <textarea id="donde"></textarea>

  </div>

  <!-- CAUSE -->
  <div class="section">
    <h2>CAUSE</h2>
    <label>Who or what triggered the problem?</label>
    <textarea id="causa"></textarea>
  </div>

  <!-- MEDIDA -->
  <div class="section">
    <h2>MEASURE</h2>

    <label>What measures do you propose to prevent stopping the production line? (e.g., use one part instead of another)</label>
    <textarea id="propuesta"></textarea>

    <label>What would happen if this deviation is not implemented? (e.g., ‚ÄúTo prevent stopping the production line, part X from supplier Y will be used.‚Äù)</label>
    <textarea id="consecuencia"></textarea>

    <label>Who will be in charge of implementing this solution? (e.g., supplier, internal production, etc.)</label>
    <input type="text" id="responsable">

    <label>If expenses are generated, who will cover them?</label>
    <input type="text" id="cost">

    <label>In cases where the motive is ‚ÄúMissing K & BMG release", ensure documentation covers legal conformity, safety, and market suitability of the component.</label>
    <input type="text" id="legal">

  </div>

  <div class="section">
    <div id="notfallExtras" class="hidden">
    <h2>NOTFALL CONTROL QUESTIONS</h2>

      <label>Has the alternative installation already been implemented?</label>
      <input type="text" id="instalacionAlt">

      <label>Is an exact date established for the alternative installation?</label>
      <input type="text" id="fechaAlt">

      <label>Is it possible to implement the alternative shoring immediately, prior to approval?</label>
      <input type="text" id="apuntalamiento">
    </div>
    </div>
  

  <!-- RESULT'S BUTTON -->
  <button onclick="generarResumen()">Generate and Copy Prompt</button>

</div>

<!-- Select Copilot -->
<div id="copilotSection" class="copilot-section hidden">
  <button onclick="enviarACopilot()" id="botonCopilot">üöÄ Go to Microsoft Copilot</button>
  <p id="mensajeCopilot" class="description">
    ‚úÖ The prompt has been copied. <strong>Click on the button above</strong> or go to Microsoft Copilot and press <strong>Ctrl + V</strong> to paste it.
  </p>
</div>

<!-- RESULT -->
<div id="resultado" class="result hidden"></div>

<script>
const descripciones = {
  regular: `‚Ä¢ There is no risk of the PC8 permit being issued quickly.
‚Ä¢ Foreseeable need for a deviation
‚Ä¢ Plannable event.
‚Ä¢ Impact >6 weeks.`,
  eilt: `‚Ä¢ It may not be possible to issue the PC8 permit quickly (<6 weeks).
‚Ä¢ Need has already arisen, unforseen event.
‚Ä¢ Requires rapid action.`,
  notfall: `‚Ä¢ PC8 completely halted.
‚Ä¢ Immediate need for AE approval.
‚Ä¢ Imminent danger.`
};

const promptBase = `All permits must meet the following key requirements:
1. Problem:
‚Ä¢ Clearly state whether the change is a techincal modification to the vehicle.
‚Ä¢ Provicde a clear, complete, and understandable description of the problem -- even for non-experts.
‚Ä¢ Avoid abbreviations, or spell them out the first time they appear.
‚Ä¢ Include specific details, such as restrictions on certain vehicles or particular reasons for the addition.
‚Ä¢ Specify the trigger for the problem: where and when it was detected ( e.g., DMU analysis, construction test, etc.)
2. Cause:
‚Ä¢ Explain who or what caused the issue, and where it occured.
‚Ä¢ The cause must be described in a clear, complete and easily understandable way.
3. Measure:
‚Ä¢ The proposed solutions must be clearly described and include all necessary details.
‚Ä¢ Specify who will implement this measure (e.g., supplier or production) and indicate the affected part of the vehicle.
‚Ä¢ If expenses aremad, clearly state who will cover them (department or area).
‚Ä¢ The measure must be an obligatory technical change.
‚Ä¢ For the permits with motive "Missing K & BMG release", documentation must include:
  o Legal conformity, safety, and market suitability of the component.

If 'Na' appears in any part of the text, it will be considered as 'not applicable', and that citerion will be exclused from the review.

You'll receve a text. Your task is to identify which mandatory elements are missing according to the type of permit.
Do not add or invent any data - only point out the missing elements.

The outcome must be presented on a table format, including the following languages:
‚Ä¢ Spanish
‚Ä¢ English
‚Ä¢ German

Final text:\n`;

function mostrarFormulario() {
  const tipo = document.getElementById('permiso').value;
  const desc = document.getElementById('descripcion');
  const form = document.getElementById('formulario');
  const extras = document.getElementById('notfallExtras');
  const copilotSection = document.getElementById('copilotSection');
  const resultado = document.getElementById('resultado');

  if (tipo === "doc") {
    // Oculta formulario y descripci√≥n
    desc.classList.add('hidden');
    form.classList.add('hidden');

    // Muestra prompt directamente
    const fullText = promptBase + "[Pega aqu√≠ tu texto ya generado...]";
    resultado.textContent = fullText;
    resultado.classList.remove('hidden');

    // Mostrar secci√≥n Copilot
    copilotSection.classList.remove('hidden');

    // Copiar autom√°ticamente
    navigator.clipboard.writeText(fullText).then(() => {
      alert("‚úÖ Prompt copiado autom√°ticamente. Ahora haz clic en el bot√≥n o ve a Copilot y presiona Ctrl + V.");
    }).catch(() => {
      alert("‚ùå No se pudo copiar autom√°ticamente. Copia manualmente.");
    });
  } else if (tipo) {
    desc.textContent = descripciones[tipo] || "";
    desc.classList.remove('hidden');
    form.classList.remove('hidden');
    extras.classList.toggle('hidden', tipo !== 'notfall');

    // Ocultar elementos espec√≠ficos del caso "doc"
    copilotSection.classList.add('hidden');
    resultado.classList.add('hidden');
  } else {
    // Reinicia todo si no se selecciona nada
    desc.classList.add('hidden');
    form.classList.add('hidden');
    extras.classList.add('hidden');
    copilotSection.classList.add('hidden');
    resultado.classList.add('hidden');
  }
}

function generarResumen() {
  const tipo = document.getElementById('permiso').value;
  if (tipo === "doc") return;
  
  // Validar campos obligatorios
  const camposObligatorios = [
    { id: 'necesidades', nombre: 'Needs' },
    { id: 'proyecto', nombre: 'Project' },
    { id: 'np', nombre: 'Affected Part Number and Location' },
    { id: 'fecha', nombre: 'Date' },
    { id: 'quePasa', nombre: 'What is happening?' },
    { id: 'tecnico', nombre: 'Technical issue' },
    { id: 'particularidades', nombre: 'Extra particularities' },
    { id: 'donde', nombre: 'Where was the issue detected?' },
    { id: 'causa', nombre: 'Who or what triggered the problem?' },
    { id: 'propuesta', nombre: 'What measures do you propose to prevent stopping the production line?' },
    { id: 'consecuencia', nombre: 'What would happen if this deviation is not implemented?' },
    { id: 'responsable', nombre: 'Who will be in charge of implementing this solution?' }
  ];

  if (tipo === 'notfall') {
    camposObligatorios.push(
      { id: 'instalacionAlt', nombre: 'Has the alternative installation already been implemented?' },
      { id: 'fechaAlt', nombre: 'Is an exact date establihshed for the alternative installation?' },
      { id: 'apuntalamiento', nombre: 'Is it possible to implement the alternative shoring immediately?' }
    );
  }

  const camposFaltantes = camposObligatorios.filter(campo => {
    const valor = document.getElementById(campo.id).value.trim();
    return valor === '';
  });

  if (camposFaltantes.length > 0) {
    const listaCampos = camposFaltantes.map(c => `‚Ä¢ ${c.nombre}`).join('\n');
    alert(`‚ö†Ô∏è Please complete all mandatory fields before generating the prompt:\n\n${listaCampos}`);
    return;
  }

  const necesidades = document.getElementById('necesidades').value;
  const proyecto = document.getElementById('proyecto').value;
  const np = document.getElementById('np').value;
  const fecha = document.getElementById('fecha').value;
  const quePasa = document.getElementById('quePasa').value;
  const particularidades = document.getElementById('particularidades').value;
  const tecnico = document.getElementById('tecnico').value;
  const causa = document.getElementById('causa').value;
  const donde = document.getElementById('donde').value;
  const propuesta = document.getElementById('propuesta').value;
  const consecuencia = document.getElementById('consecuencia').value;
  const responsable = document.getElementById('responsable').value;
  const cost = document.getElementById('cost').value;
  const legal = document.getElementById('legal').value;

  let resumen = `PERMIT TYPE: ${tipo.toUpperCase()}\n\n`;

  resumen += `PROBLEM:\n- Needs: ${necesidades}\n- Project: ${proyecto}\n- Affected Part Number: ${np}\n- Date: ${fecha}\n- What is happening: ${quePasa}\n- Technical issue: ${tecnico}\n- Particularities: ${particularidades}\n-Where did it happen:${donde}\n\n`;
  resumen += `CAUSE:\n${causa}\n\n`;
  resumen += `MEASURE:\n- Proposal: ${propuesta}\n- Consequence: ${consecuencia}\n- Responsible: ${responsable}\n- Who covers the expenses: ${cost}\n- Missing K & BMG release ${legal}\n\n`;

  if (tipo === 'notfall') {
    const instalacionAlt = document.getElementById('instalacionAlt').value;
    const fechaAlt = document.getElementById('fechaAlt').value;
    const apuntalamiento = document.getElementById('apuntalamiento').value;

    resumen += `\nADDITIONAL QUESTIONS:\n- Alternative installation: ${instalacionAlt}\n- Defined date: ${fechaAlt}\n- Possible alternative shoring: ${apuntalamiento}\n`;
  }

  const fullText = promptBase + resumen;

  const resultBox = document.getElementById('resultado');
  resultBox.textContent = fullText;
  resultBox.classList.remove('hidden');

  const copilotSection = document.getElementById('copilotSection');
  copilotSection.classList.remove('hidden');

  navigator.clipboard.writeText(fullText).then(() => {
    alert("‚úÖ Text copied to clipboard.");
  }).catch(err => {
    alert("‚ùå Could not copy automatically. Copy manually.");
  });
}

function enviarACopilot() {
  window.open("https://copilot.microsoft.com", "_blank");
}

</script>

</body>
</html>
